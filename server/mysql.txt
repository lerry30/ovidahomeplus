CREATE DATABASE ovida;
USE ovida;

CREATE TABLE employees(
	id INT PRIMARY KEY AUTO_INCREMENT, 
    firstname VARCHAR(255) NOT NULL, 
	lastname VARCHAR(255) NOT NULL, 
	username VARCHAR(255) NOT NULL UNIQUE,
	password VARCHAR(255) NOT NULL,
	image VARCHAR(255) DEFAULT '',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE suppliers(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(255) NOT NULL,
	contact VARCHAR(255) NOT NULL,
	image VARCHAR(255) NOT NULL,
	status ENUM('active', 'inactive') DEFAULT 'active',
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE product_types(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(255) NOT NULL UNIQUE,
	image VARCHAR(255) NOT NULL,
	status ENUM('active', 'inactive') DEFAULT 'active',
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE deliveries(
	id INT PRIMARY KEY AUTO_INCREMENT,
	supplier_id INT NOT NULL,
	batch_no INT NOT NULL,
	delivery_reciept_no VARCHAR(255) NOT NULL,
	date DATE NOT NULL,
	FOREIGN KEY(supplier_id) REFERENCES suppliers(id)
);

CREATE TABLE modification_history(
	id INT PRIMARY KEY AUTO_INCREMENT,
	employee_id INT NOT NULL,
	category ENUM('item', 'supplier', 'product', 'delivered') DEFAULT 'item',
	action ENUM('added', 'updated', 'deleted') DEFAULT 'added',
	modification_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE items(
	id INT PRIMARY KEY AUTO_INCREMENT,
	supplier_id INT NOT NULL,
	product_type_id INT NOT NULL,
	description VARCHAR(255) NOT NULL,
	item_code VARCHAR(255) NOT NULL,
	delivery_price INT NOT NULL,
	srp INT NOT NULL,
	max_discount INT NOT NULL,
	unit ENUM('pcs', 'set') DEFAULT 'pcs',
	image VARCHAR(255) NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	FOREIGN KEY(product_type_id) REFERENCES product_types(id),
	FOREIGN KEY(supplier_id) REFERENCES suppliers(id)
);

CREATE TABLE disabled_items(
	id INT PRIMARY KEY AUTO_INCREMENT,
	item_id INT NOT NULL,
	note VARCHAR(255) NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY(item_id) REFERENCES items(id)
);

CREATE TABLE batches(
	id INT PRIMARY KEY AUTO_INCREMENT,
	batch_no INT NOT NULL UNIQUE,
	delivery_reciept_no VARCHAR(255) NOT NULL,
	delivery_date DATE,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE barcodes(
	id INT PRIMARY KEY AUTO_INCREMENT,
	item_id INT NOT NULL,
	batch_no INT NOT NULL,
	barcode VARCHAR(255) UNIQUE NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	FOREIGN KEY(item_id) REFERENCES items(id),
	FOREIGN KEY(batch_no) REFERENCES batches(batch_no)
);

CREATE TABLE customers(
	id INT PRIMARY KEY AUTO_INCREMENT,
	firstname VARCHAR(255) NOT NULL,
	lastname VARCHAR(255) NOT NULL,
	address VARCHAR(255) NOT NULL,
	first_contact_no VARCHAR(255) NOT NULL,
	second_contact_no VARCHAR(255) DEFAULT '' NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE sold_items(
	id INT PRIMARY KEY AUTO_INCREMENT,
	barcode VARCHAR(255) UNIQUE NOT NULL,
	is_discounted TINYINT(1) NOT NULL,
	customer_id INT NOT NULL,
	payment_method VARCHAR(255) NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	FOREIGN KEY(barcode) REFERENCES barcodes(barcode),
	FOREIGN KEY(customer_id) REFERENCES customers(id)
);

CREATE TABLE expenses(
	id INT PRIMARY KEY AUTO_INCREMENT,
	type VARCHAR(255) NOT NULL,
	amount INT NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE cash_denominations(
    id INT PRIMARY KEY AUTO_INCREMENT,
    one_thousand INT NOT NULL,
    five_hundred INT NOT NULL,
    two_hundred INT NOT NULL,
    one_hundred INT NOT NULL,
    fifty INT NOT NULL,
    twenty INT NOT NULL,
    ten INT NOT NULL,
    five INT NOT NULL,
    one INT NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE cash_payments(
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    payment_denomination_id INT NOT NULL,
    total_payment INT NOT NULL,
    total_change INT NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY(customer_id) REFERENCES customers(id),
    FOREIGN KEY(payment_denomination_id) REFERENCES cash_denominations(id)
);

CREATE TABLE cash_drawer_contents(
    id INT PRIMARY KEY AUTO_INCREMENT,
    cash_denomination_id INT NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY(cash_denomination_id) REFERENCES cash_denominations(id)
);
